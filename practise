<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameBridge | Admin Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: white; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        input, select { background: rgba(255,255,255,0.1) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; }
        #userList::-webkit-scrollbar, #eventFeed::-webkit-scrollbar { width: 4px; }
        #userList::-webkit-scrollbar-thumb, #eventFeed::-webkit-scrollbar-thumb { background: rgba(0, 245, 212, 0.2); border-radius: 10px; }
        .status-pill { padding: 2px 8px; border-radius: 4px; font-size: 9px; font-weight: 800; text-transform: uppercase; }
    </style>
</head>
<body class="p-4 md:p-8">
    <nav class="flex justify-between items-center mb-10">
        <div class="flex items-center gap-2">
            <span class="text-2xl">üéÆ</span>
            <h1 class="text-2xl font-bold text-cyan-400">GameBridge <span class="text-white font-light text-sm uppercase tracking-widest ml-2 italic">Master Portal</span></h1>
        </div>
        <div class="flex items-center gap-4">
            <span class="text-xs text-gray-400 hidden md:block">System Status: <span class="text-green-400">Secure</span></span>
            <button id="logoutBtn" class="text-sm bg-red-500/20 text-red-400 px-4 py-2 rounded-lg hover:bg-red-500 hover:text-white transition">Logout</button>
        </div>
    </nav>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-10">
        <div class="glass p-6 rounded-2xl border-l-4 border-blue-500">
            <p class="text-gray-400 text-xs uppercase font-bold tracking-tighter">Total Players</p>
            <h2 id="playerCount" class="text-3xl font-bold">0</h2>
        </div>
        <div class="glass p-6 rounded-2xl border-l-4 border-purple-500">
            <p class="text-gray-400 text-xs uppercase font-bold tracking-tighter">Live Inventory</p>
            <h2 id="gameCount" class="text-3xl font-bold">0</h2>
        </div>
        <div class="glass p-6 rounded-2xl border-l-4 border-cyan-400">
            <p class="text-gray-400 text-xs uppercase font-bold tracking-tighter">Total Revenue Earned</p>
            <h2 id="totalRevenue" class="text-3xl font-bold text-cyan-400">$0.00</h2>
        </div>
        <div class="glass p-6 rounded-2xl border-l-4 border-green-500">
            <p class="text-gray-400 text-xs uppercase font-bold tracking-tighter">Events Logged</p>
            <h2 id="eventCount" class="text-3xl font-bold">0</h2>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="glass p-6 rounded-3xl h-[600px] flex flex-col">
            <h3 class="text-lg font-bold mb-4 flex items-center justify-between">
                <span>Player Directory</span>
                <span id="liveIndicator" class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
            </h3>
            <div id="userList" class="space-y-3 overflow-y-auto pr-2 flex-grow">
                <p class="text-center text-gray-500 py-10">Searching for players...</p>
            </div>
        </div>

        <div class="glass p-6 rounded-3xl h-[600px] flex flex-col border-t-2 border-cyan-900">
            <h3 class="text-lg font-bold mb-4 text-cyan-400">Live Billing Stream</h3>
            <div id="eventFeed" class="space-y-3 overflow-y-auto pr-2 flex-grow">
                <p class="text-center text-gray-500 py-10">Waiting for triggers...</p>
            </div>
        </div>

        <div class="glass p-6 rounded-3xl h-fit">
            <h3 class="text-lg font-bold mb-4 text-cyan-400">Deploy New Game</h3>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] text-gray-400 uppercase font-bold">Game & Studio Info</label>
                    <input type="text" id="gameTitle" placeholder="Game Title" class="w-full p-3 rounded-xl outline-none mt-1 mb-2">
                    <input type="text" id="gameUrl" placeholder="Game URL (https://...)" class="w-full p-3 rounded-xl outline-none mb-2">
                    <input type="text" id="studioName" placeholder="Studio Name" class="w-full p-3 rounded-xl outline-none">
                </div>
                
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="text-[10px] text-gray-400 uppercase font-bold">Ad Pay ($)</label>
                        <input type="number" id="adPayout" value="0.05" step="0.01" class="w-full p-3 rounded-xl outline-none mt-1">
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-400 uppercase font-bold">Inst. Pay ($)</label>
                        <input type="number" id="installPayout" value="1.00" step="0.10" class="w-full p-3 rounded-xl outline-none mt-1">
                    </div>
                </div>

                <div>
                    <label class="text-[10px] text-gray-400 uppercase font-bold">Milestone Setup</label>
                    <div class="flex gap-2">
                        <input type="number" id="targetLevel" placeholder="Level #" class="w-1/3 p-3 rounded-xl outline-none mt-1">
                        <input type="number" id="levelPayout" placeholder="$ Amount" class="w-2/3 p-3 rounded-xl outline-none mt-1">
                    </div>
                </div>

                <button id="addGameBtn" class="w-full bg-cyan-500 text-black font-black py-4 rounded-xl hover:bg-cyan-400 transition shadow-lg shadow-cyan-500/10">
                    PUSH CONFIG TO LIVE
                </button>
            </div>
        </div>
    </div>

    <div class="mt-10 glass p-6 rounded-3xl overflow-hidden">
        <h3 class="text-xl font-bold mb-6">Game Inventory & Studio Performance</h3>
        <div class="overflow-x-auto">
            <table class="w-full text-left text-sm border-collapse">
                <thead>
                    <tr class="text-gray-400 border-b border-white/10 uppercase text-[10px] tracking-widest">
                        <th class="pb-4">Game Detail</th>
                        <th class="pb-4">Studio</th>
                        <th class="pb-4">Rate Card</th>
                        <th class="pb-4">Lvl Milestone</th>
                        <th class="pb-4">Revenue</th>
                        <th class="pb-4">Status</th>
                        <th class="pb-4 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody id="inventoryTable"></tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, collection, addDoc, deleteDoc, updateDoc, doc, getDoc,
            serverTimestamp, onSnapshot, query, orderBy, limit, where 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyCLd4MLONU_5OFie6WN2XmXmlMyfuJ5_8I",
            authDomain: "gamebridge-f4789.firebaseapp.com",
            projectId: "gamebridge-f4789",
            storageBucket: "gamebridge-f4789.firebasestorage.app",
            messagingSenderId: "562553872482",
            appId: "1:562553872482:web:02b34e7bc1b7a25af8f13b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const ADMIN_EMAIL = "ownergamebridge@gmail.com";

        onAuthStateChanged(auth, (u) => { if (!u || u.email !== ADMIN_EMAIL) window.location.href = 'index.html'; });
        document.getElementById('logoutBtn').addEventListener('click', () => signOut(auth).then(() => window.location.href = 'index.html'));

        // --- 1. PLAYER LIST ---
        onSnapshot(collection(db, "users"), (snap) => {
            document.getElementById('playerCount').innerText = snap.size;
            const list = document.getElementById('userList');
            list.innerHTML = "";
            snap.forEach(d => {
                const u = d.data();
                list.innerHTML += `
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-2xl border border-white/5 group transition">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-cyan-500/10 rounded-xl flex items-center justify-center text-cyan-400 font-bold border border-cyan-500/20">${u.email[0].toUpperCase()}</div>
                            <div>
                                <p class="text-[11px] font-bold truncate w-24">${u.email}</p>
                                <p class="text-[9px] text-gray-400 uppercase font-black">${u.status || 'Active'}</p>
                            </div>
                        </div>
                        <button onclick="deleteUser('${d.id}')" class="text-[10px] text-red-500 opacity-0 group-hover:opacity-100 px-2 py-1 bg-red-500/10 rounded">KICK</button>
                    </div>`;
            });
        });
        window.deleteUser = (id) => confirm("Kick this player?") && deleteDoc(doc(db, "users", id));

        // --- 2. GLOBAL REVENUE & FEED (Corrected Accounting) ---
        onSnapshot(collection(db, "events"), (snap) => {
            let total = 0;
            snap.forEach(d => total += (d.data().value || 0));
            document.getElementById('totalRevenue').innerText = `$${total.toFixed(2)}`;
            document.getElementById('eventCount').innerText = snap.size;
        });

        onSnapshot(query(collection(db, "events"), orderBy("timestamp", "desc"), limit(25)), (snap) => {
            const feed = document.getElementById('eventFeed');
            feed.innerHTML = "";
            snap.forEach(d => {
                const e = d.data();
                feed.innerHTML += `
                    <div class="p-4 bg-cyan-400/5 rounded-2xl border-l-4 border-cyan-400 text-[11px] mb-2">
                        <div class="flex justify-between font-black">
                            <span class="text-cyan-400 tracking-widest uppercase">${e.type}</span>
                            <span class="text-green-400">+$${(e.value||0).toFixed(2)}</span>
                        </div>
                        <p class="text-gray-300 mt-1">${e.userName}</p>
                        <p class="text-gray-500 text-[9px] uppercase">${e.gameName} ‚Ä¢ ${e.timestamp ? new Date(e.timestamp.toDate()).toLocaleTimeString() : '...'}</p>
                    </div>`;
            });
        });

        // --- 3. AUTO-BILLING ENGINE (Fixed Milestones) ---
        onSnapshot(query(collection(db, "playerProgress"), where("milestonePaid", "==", false)), (snap) => {
            snap.forEach(async docSnap => {
                const data = docSnap.data();
                const gameRef = doc(db, "games", data.gameId);
                const gSnap = await getDoc(gameRef);
                
                if (gSnap.exists() && data.level >= (gSnap.data().milestones?.level || 999)) {
                    const payout = gSnap.data().milestones.payout;
                    await updateDoc(doc(db, "playerProgress", docSnap.id), { milestonePaid: true });
                    await addDoc(collection(db, "events"), {
                        userName: data.userId, gameName: gSnap.data().title,
                        type: `Milestone Lvl ${gSnap.data().milestones.level}`,
                        value: Number(payout), timestamp: serverTimestamp()
                    });
                    const currentRev = gSnap.data().accumulatedRevenue || 0;
                    await updateDoc(gameRef, { accumulatedRevenue: currentRev + Number(payout) });
                }
            });
        });

        // --- 4. INVENTORY TABLE ---
        onSnapshot(collection(db, "games"), (snap) => {
            document.getElementById('gameCount').innerText = snap.size;
            const table = document.getElementById('inventoryTable');
            table.innerHTML = "";
            snap.forEach(d => {
                const g = d.data();
                table.innerHTML += `
                    <tr class="border-b border-white/5 hover:bg-white/5">
                        <td class="py-5"><p class="font-bold text-cyan-400">${g.title}</p></td>
                        <td class="py-5 text-gray-400">${g.studio}</td>
                        <td class="py-5 text-[10px]">Ad: $${g.adPayout}<br>Ins: $${g.installPayout}</td>
                        <td class="py-5 text-[10px] text-purple-400 font-bold">Lvl ${g.milestones?.level} ($${g.milestones?.payout})</td>
                        <td class="py-5 font-bold text-green-400">$${(g.accumulatedRevenue || 0).toFixed(2)}</td>
                        <td class="py-5"><span class="status-pill ${g.status==='active'?'text-green-400':'text-red-400'}">${g.status}</span></td>
                        <td class="py-5 text-right">
                            <button onclick="toggleGame('${d.id}', '${g.status}')">‚è∏Ô∏è</button>
                            <button onclick="deleteGame('${d.id}')" class="text-red-500 ml-2">üóëÔ∏è</button>
                        </td>
                    </tr>`;
            });
        });

        window.toggleGame = (id, cur) => updateDoc(doc(db, "games", id), { status: cur === 'active' ? 'disabled' : 'active' });
        window.deleteGame = (id) => confirm("Delete game?") && deleteDoc(doc(db, "games", id));

        // --- 5. DEPLOY GAME ---
        document.getElementById('addGameBtn').addEventListener('click', async () => {
            const btn = document.getElementById('addGameBtn');
            const gameData = {
                title: document.getElementById('gameTitle').value,
                url: document.getElementById('gameUrl').value,
                studio: document.getElementById('studioName').value,
                adPayout: Number(document.getElementById('adPayout').value) || 0,
                installPayout: Number(document.getElementById('installPayout').value) || 0,
                milestones: { 
                    level: Number(document.getElementById('targetLevel').value) || 0, 
                    payout: Number(document.getElementById('levelPayout').value) || 0 
                },
                status: 'active', accumulatedRevenue: 0, createdAt: serverTimestamp()
            };

            if(!gameData.title || !gameData.url) return alert("Fill required fields");
            btn.disabled = true;
            try {
                await addDoc(collection(db, "games"), gameData);
                alert("Deployed!");
            } catch (e) { alert(e.message); }
            btn.disabled = false;
        });
    </script>
</body>
</html>






rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Global Functions
    function isSignedIn() { return request.auth != null; }
    function isAdmin() { return isSignedIn() && request.auth.token.email == 'ownergamebridge@gmail.com'; }
    function isOwner(userId) { return isSignedIn() && request.auth.uid == userId; }

    // 1. User Profiles
    match /users/{userId} {
      allow read: if isSignedIn();
      // Users can only create their own profile and cannot set their own role to 'admin'
      allow create: if isOwner(userId) && request.resource.data.role != 'admin';
      // Only the actual Admin can change roles or status
      allow update: if isAdmin() || (isOwner(userId) && request.resource.data.diff(resource.data).affectedKeys().hasOnly(['status', 'lastLogin']));
      allow delete: if isAdmin();
    }

    // 2. Games Collection
    match /games/{gameId} {
      // Publicly viewable by all logged-in players, but only admin can touch the config
      allow read: if isSignedIn();
      allow write: if isAdmin();
    }

    // 3. Events (The Billing System) - MOST IMPORTANT
    match /events/{eventId} {
      // Prevents players from reading other people's earnings
      allow read: if isAdmin() || (isSignedIn() && resource.data.userName == request.auth.token.email);
      
      allow create: if isSignedIn() 
        // Force the email in the event to match the logged-in user
        && request.resource.data.userName == request.auth.token.email
        // Hard-cap payouts from the client-side to prevent "Million Dollar" fake events
        && request.resource.data.value <= 5.0
        // Ensure they can't create events in the future
        && request.resource.data.timestamp == request.time;

      // NO ONE can edit or delete a billing event once it is created (Audit Trail)
      allow update, delete: if isAdmin();
    }

    // 4. Player Progress
    match /playerProgress/{docId} {
      allow read: if isAdmin() || (isSignedIn() && resource.data.userId == request.auth.token.email);
      allow create: if isSignedIn() && request.resource.data.userId == request.auth.token.email;
      allow update: if isAdmin(); // Only admin can mark a milestone as "Paid"
      allow delete: if isAdmin();
    }
  }
}















‚ÄãüéÆ GameBridge ‚Äî Clear & Improved Explanation
‚Äã1Ô∏è‚É£ What GameBridge Is (Plain English)
‚ÄãGameBridge is a Progressive Web App (PWA) that:
‚ÄãLets users discover and launch games from various studios in one place.
‚ÄãMonetizes engagement for the platform owner when users:
‚ÄãWatch featured ads before playing.
‚ÄãDownload full game versions from the Play Store.
‚ÄãProgress through specific in-game levels.
‚ÄãGives you (Owner) full visibility into user actions and revenue generated per studio.
‚ÄãGives game studios a secure portal to track their game's performance and pay for the traffic you provide.
‚Äã2Ô∏è‚É£ User Flow (The Player Experience)
‚Äãüîê Step 1: Login / Sign-Up: User enters via Google or Email. Firebase manages their profile and session.
‚ÄãüïπÔ∏è Step 2: Discovery Dashboard: The user sees a curated list of games with two main options:
‚Äã‚ñ∂Ô∏è Button 1: Play Now (with Ad): User watches a featured ad to unlock a web demo or instant play version. You earn ad revenue; the user gets immediate access to the game.
‚Äãüì≤ Button 2: Get Full App: Redirects the user to the Google Play Store. If they install it, you receive an "Install Attribution" event.
‚Äã3Ô∏è‚É£ Progress Tracking (For Billing)
‚ÄãEven though players don't earn rewards, the system tracks their progress to trigger payments from the Studios to You:
‚ÄãMilestones: When a player reaches a specific level (e.g., Level 10), an event is sent to Firebase.
‚ÄãVerification: Cloud Functions verify the event is legitimate.
‚ÄãBilling: This completion is logged as a "Billable Event," meaning the studio now owes you the pre-agreed fee for driving a high-quality player to that depth in their game.
‚Äã4Ô∏è‚É£ The Admin Portal (Your View)
‚ÄãYou monitor the entire ecosystem:
‚Äãüë§ User Activity: Track active players and their engagement history.
‚Äãüì∫ Ad Analytics: See which games are generating the most ad views.
‚Äãüì• Performance Metrics: Total installs and level completions driven by your platform.
‚Äãüí∞ Balance Sheet: Real-time calculation of exactly how much each studio owes you based on the "Rate Card" you set.
‚Äã5Ô∏è‚É£ The Studio Portal
‚ÄãEach studio gets a private dashboard to justify their costs:
‚ÄãTransparency: They see the exact number of ads played and levels reached.
‚ÄãInvoicing: They view and pay invoices for the traffic/players you sent them.
‚ÄãData Only: They cannot see your other partners or access your administrative settings.
‚Äã6Ô∏è‚É£ Why GameBridge Is Powerful
‚Äã‚úÖ Platform Control: You decide the value of an install or a level completion.
‚Äã‚úÖ B2B Revenue: Your income comes from professional studios paying for performance, not from managing player payouts.
‚Äã‚úÖ Data Integrity: Every launch and level-up is a hard-coded event, making your billing impossible to dispute.
‚Äã‚úÖ Zero Friction: Works as a PWA; players don't need to install GameBridge itself to start playing.
‚Äã7Ô∏è‚É£ In One Sentence (Pitch Ready)
‚Äã"GameBridge is a Firebase-powered PWA that monetizes game discovery by tracking ad views, installs, and level-based milestones‚Äîproviding studios with a transparent, high-performance platform for user acquisition and billing

1Ô∏è‚É£ User-Facing Features (Player Dashboard / App)

This is what your players will interact with.

a) Player Dashboard

Library of games: Display demos and full apps, with filtering by studio, category, or popularity.

Skeleton loaders & smooth UX: Loading animations while data is fetched.

Responsive design: Works on desktop and mobile.

Secure login/logout: Firebase Auth (Email/password, optional Google/Apple).

b) Monetization & Tracking

Rewarded Ads (Launch Demo)

Player watches ad ‚Üí unlocks demo.

Revenue logged to Firestore (per-user, per-game).

Install Attribution / CPI Tracking (Full App)

Clicking Full App redirects to Play/App Store via tracking link.

Install confirmed ‚Üí revenue logged.

Event logging: Track clicks, ad views, installs, session duration.

c) Progress Tracking

Milestones / Levels: Track which levels/milestones each player completed.

Optional achievements & badges: Gamification layer.

d) User account & profile

View username, email, total ad rewards earned.

Account management (change password, view history).

2Ô∏è‚É£ Admin Portal (Web / Dashboard)

Admins need to manage games, track revenue, and view analytics.

a) Game Management

Add / edit / remove games.

Set status: active/inactive.

Set ad payout (adPayout) and install payout (installPayout).

Upload images / thumbnails / categories.

b) Revenue Tracking

View total ad revenue per game & per player.

View install revenue (CPI).

Aggregate analytics: daily/weekly/monthly totals.

c) Player Analytics

Track which players played which demos.

Track level/milestone completion.

Optional: Retention metrics (daily active users, sessions).

d) Admin Tools

Manual override of revenue.

Audit logs: who added/edited/removed a game.

Notifications for errors or suspicious behavior.

3Ô∏è‚É£ Backend Requirements (Firebase)

Firebase provides serverless backend. Features needed:

a) Auth

Email/password (mandatory).

Optional OAuth: Google, Apple.

b) Firestore Collections

Collection	Description
games	Stores game info (title, studio, URL, adPayout, installPayout, status, createdAt, accumulatedRevenue)
events	Logs ad views, installs, clicks, and revenue events with userName, gameName, type, value, timestamp
playerProgress	Logs milestones / levels completed by player with milestonePaid flag
users	Optional: extra player data (profile, stats)
analytics	Optional: click tracking, session duration, engagement metrics

c) Security Rules

Players: Read only for active games, write only for their events.

Admins: Full read/write access.

Prevent overwriting revenue or injecting fake events.

d) Cloud Functions (Optional but recommended)

Process deferred installs or track real revenue events from affiliate SDK.

Send notifications to players (optional).

Update accumulatedRevenue automatically on events insertion.

4Ô∏è‚É£ Ad & Monetization Integrations

a) Rewarded Ads

SDKs: Tapjoy, AppLovin, IronSource, AdMob.

Player must watch full ad ‚Üí revenue credited.

Optional: Cap ads per session/day.

b) Install Attribution / CPI

Affiliate SDK or tracking links.

Must confirm install ‚Üí revenue credited.

Optional: Deep link to store or redirect based on device OS.

c) Analytics & ROI Tracking

Track CTR for Play / Install buttons.

Track ad completions.

Provide per-game revenue reports to studios.














// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCLd4MLONU_5OFie6WN2XmXmlMyfuJ5_8I",
  authDomain: "gamebridge-f4789.firebaseapp.com",
  projectId: "gamebridge-f4789",
  storageBucket: "gamebridge-f4789.firebasestorage.app",
  messagingSenderId: "562553872482",
  appId: "1:562553872482:web:02b34e7bc1b7a25af8f13b",
  measurementId: "G-X3B8B4L4XW"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

















