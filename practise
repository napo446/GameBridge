rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /* ============================
       ğŸŒ GLOBAL HELPERS
    ============================ */
    function isSignedIn() {
      return request.auth != null;
    }

    // Fail-safe: Admin via Custom Claim OR hardcoded email
    function isAdmin() {
      return isSignedIn() && (
        request.auth.token.admin == true || 
        request.auth.token.email == 'ownergamebridge@gmail.com'
      );
    }

    function isOwner(uid) {
      return isSignedIn() && request.auth.uid == uid;
    }

    /* ============================
       ğŸ‘¤ USERS (Profile Sync)
    ============================ */
    match /users/{userId} {
      allow read: if isOwner(userId) || isAdmin();

      // Ensure players can't create an account and label themselves "admin"
      allow create: if isOwner(userId)
        && !("admin" in request.resource.data)
        && request.resource.data.role == "player";

      // Allow profile updates (lastLogin, etc) but lock critical fields
      allow update: if isOwner(userId)
        && !("admin" in request.resource.data)
        && !("role" in request.resource.data);

      allow delete: if isAdmin();
    }

    /* ============================
       ğŸ® GAMES (Catalog & Rates)
    ============================ */
    match /games/{gameId} {
      // Players see active games; Admin sees drafts/configs
      allow read: if isAdmin() || (isSignedIn() && resource.data.status == "active");
      
      allow create, delete: if isAdmin();

      // Prevent anyone but Admin from changing game details
      // Also prevents client-side "accumulatedRevenue" manipulation
      allow update: if isAdmin()
        && !("accumulatedRevenue" in request.resource.data);
    }

    /* ============================
       ğŸ“Š EVENTS (The Immutable Billing Log)
    ============================ */
    match /events/{eventId} {
      allow read: if isAdmin(); // Only Admin audits the full log

      // Players can log their own actions (Login, Ad View, Install)
      allow create: if isSignedIn()
        && request.resource.data.userId == request.auth.uid
        && request.resource.data.type in ["login", "ad_view", "install", "click"]
        // BLOCK REVENUE INJECTION: Value must come from Admin-side calculation, not the player's browser
        && !("value" in request.resource.data)
        && request.resource.data.timestamp == request.time;

      // Billing events can NEVER be changed or deleted (Audit Trail)
      allow update, delete: if false;
    }

    /* ============================
       ğŸ¯ PLAYER PROGRESS (Milestones)
    ============================ */
    match /playerProgress/{progressId} {
      allow read: if isAdmin() || isOwner(resource.data.userId);

      allow create: if isSignedIn()
        && request.resource.data.userId == request.auth.uid
        && request.resource.data.milestonePaid == false;

      // Only Cloud Functions/Admin can flip the 'paid' switch
      allow update: if isAdmin() || (
        isOwner(resource.data.userId) && 
        request.resource.data.milestonePaid == resource.data.milestonePaid
      );
    }

    /* ============================
       ğŸ“ˆ ANALYTICS & DEFAULT DENY
    ============================ */
    match /analytics/{docId} {
      allow create: if isSignedIn();
      allow read, write: if isAdmin();
    }

    // Global Catch-all: If it's not explicitly allowed above, block it.
    match /{document=**} {
      allow read, write: if false;
    }
  }
}




rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // --- GLOBAL HELPERS ---
    
    function isSignedIn() {
      return request.auth != null;
    }

    function isAdmin() {
      return isSignedIn() && (
        request.auth.token.admin == true || 
        request.auth.token.email == 'ownergamebridge@gmail.com'
      );
    }

    function isOwner(uid) {
      return isSignedIn() && request.auth.uid == uid;
    }

    function isEmailOwner(email) {
      return isSignedIn() && request.auth.token.email == email;
    }

    // --- COLLECTION RULES ---

    // 1. Games: Catalog & Rate Card
    match /games/{gameId} {
      // Players can only see active games; Admin sees drafts/disabled ones too
      allow read: if isAdmin() || (isSignedIn() && resource.data.status == "active");
      allow write: if isAdmin();
    }

    // 2. Events: The Immutable Billing Log
    match /events/{eventId} {
      // Admin monitors all; Players only see their own history
      allow read: if isAdmin() || isEmailOwner(resource.data.userName) || isOwner(resource.data.userId);
      
      // CREATE: Players can log ads/installs, but must match their own identity
      // We enforce server-side timestamps to prevent backdating fraud
      allow create: if isSignedIn() 
        && (request.resource.data.userName == request.auth.token.email || request.resource.data.userId == request.auth.uid)
        && request.resource.data.value >= 0 // Prevent negative balance injection
        && request.resource.data.timestamp == request.time; 

      // NO UPDATES: Once a billing event is logged, it cannot be changed by the player
      allow update, delete: if isAdmin();
    }

    // 3. Player Progress: Milestone Tracking
    match /playerProgress/{docId} {
      allow read: if isAdmin() || isOwner(resource.data.userId);
      allow create: if isSignedIn() && request.resource.data.userId == request.auth.uid;
      
      // UPDATE: Players can update their level, but CANNOT toggle 'milestonePaid'
      // This is the most critical rule for your B2B billing integrity.
      allow update: if isAdmin() || (
        isOwner(resource.data.userId) && 
        request.resource.data.milestonePaid == resource.data.milestonePaid
      );
    }

    // 4. User Profiles
    match /users/{userId} {
      allow read: if isAdmin() || isOwner(userId);
      // Allows sync on login for the specific user
      allow write: if isAdmin() || isOwner(userId);
    }

    // 5. Analytics & Metadata
    match /analytics/{docId} {
      allow create: if isSignedIn();
      allow read, write: if isAdmin();
    }
  }
}



rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /* ============================
       ğŸ” HELPER FUNCTIONS
    ============================ */
    function isSignedIn() {
      return request.auth != null;
    }

    // Admin via custom claim (RECOMMENDED)
    function isAdmin() {
      return isSignedIn() && request.auth.token.admin == true;
    }

    function isOwner(uid) {
      return isSignedIn() && request.auth.uid == uid;
    }

    /* ============================
       ğŸ‘¤ USERS
    ============================ */
    match /users/{userId} {

      // Player reads own profile, admin reads all
      allow read: if isOwner(userId) || isAdmin();

      // Create profile on signup
      allow create: if isOwner(userId)
        && request.resource.data.role == "player"
        && !("admin" in request.resource.data);

      // Player may update safe fields only
      allow update: if isOwner(userId)
        && !("role" in request.resource.data)
        && !("admin" in request.resource.data);

      // Admin only
      allow delete: if isAdmin();
    }

    /* ============================
       ğŸ® GAMES (ADMIN OWNED)
    ============================ */
    match /games/{gameId} {

      // Logged-in users can discover games
      allow read: if isSignedIn();

      // Admin controls all game data
      allow create, delete: if isAdmin();

      // Prevent client-side revenue tampering
      allow update: if isAdmin()
        && !("accumulatedRevenue" in request.resource.data);
    }

    /* ============================
       ğŸ“Š EVENTS (IMMUTABLE LOG)
       Ads / Installs / Logins
    ============================ */
    match /events/{eventId} {

      // Admin analytics only
      allow read: if isAdmin();

      // Player can log ONLY their own events
      allow create: if isSignedIn()
        && request.resource.data.userId == request.auth.uid
        && request.resource.data.type in [
          "signup",
          "login",
          "ad_view",
          "install",
          "click",
          "session"
        ]
        // Block revenue injection
        && !("value" in request.resource.data)
        && !("paid" in request.resource.data);

      // Events are write-once
      allow update, delete: if false;
    }

    /* ============================
       ğŸ¯ PLAYER PROGRESS
       (Milestones / Levels)
    ============================ */
    match /playerProgress/{progressId} {

      // Player sees own progress, admin sees all
      allow read: if isAdmin()
        || request.auth.uid == resource.data.userId;

      // Player submits milestone ONCE
      allow create: if isSignedIn()
        && request.resource.data.userId == request.auth.uid
        && request.resource.data.level >= 1
        && request.resource.data.milestonePaid == false;

      // Only Cloud Functions / Admin can mark paid
      allow update: if isAdmin();

      allow delete: if false;
    }

    /* ============================
       ğŸ“ˆ ANALYTICS / AGGREGATES
    ============================ */
    match /analytics/{docId} {
      allow read: if isAdmin();
      allow write: if false;
    }

    /* ============================
       ğŸš« DEFAULT DENY (CRITICAL)
    ============================ */
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
























â€‹ğŸ® GameBridge â€” Clear & Improved Explanation
â€‹1ï¸âƒ£ What GameBridge Is (Plain English)
â€‹GameBridge is a Progressive Web App (PWA) that:
â€‹Lets users discover and launch games from various studios in one place.
â€‹Monetizes engagement for the platform owner when users:
â€‹Watch featured ads before playing.
â€‹Download full game versions from the Play Store.
â€‹Progress through specific in-game levels.
â€‹Gives you (Owner) full visibility into user actions and revenue generated per studio.
â€‹Gives game studios a secure portal to track their game's performance and pay for the traffic you provide.
â€‹2ï¸âƒ£ User Flow (The Player Experience)
â€‹ğŸ” Step 1: Login / Sign-Up: User enters via Google or Email. Firebase manages their profile and session.
â€‹ğŸ•¹ï¸ Step 2: Discovery Dashboard: The user sees a curated list of games with two main options:
â€‹â–¶ï¸ Button 1: Play Now (with Ad): User watches a featured ad to unlock a web demo or instant play version. You earn ad revenue; the user gets immediate access to the game.
â€‹ğŸ“² Button 2: Get Full App: Redirects the user to the Google Play Store. If they install it, you receive an "Install Attribution" event.
â€‹3ï¸âƒ£ Progress Tracking (For Billing)
â€‹Even though players don't earn rewards, the system tracks their progress to trigger payments from the Studios to You:
â€‹Milestones: When a player reaches a specific level (e.g., Level 10), an event is sent to Firebase.
â€‹Verification: Cloud Functions verify the event is legitimate.
â€‹Billing: This completion is logged as a "Billable Event," meaning the studio now owes you the pre-agreed fee for driving a high-quality player to that depth in their game.
â€‹4ï¸âƒ£ The Admin Portal (Your View)
â€‹You monitor the entire ecosystem:
â€‹ğŸ‘¤ User Activity: Track active players and their engagement history.
â€‹ğŸ“º Ad Analytics: See which games are generating the most ad views.
â€‹ğŸ“¥ Performance Metrics: Total installs and level completions driven by your platform.
â€‹ğŸ’° Balance Sheet: Real-time calculation of exactly how much each studio owes you based on the "Rate Card" you set.
â€‹5ï¸âƒ£ The Studio Portal
â€‹Each studio gets a private dashboard to justify their costs:
â€‹Transparency: They see the exact number of ads played and levels reached.
â€‹Invoicing: They view and pay invoices for the traffic/players you sent them.
â€‹Data Only: They cannot see your other partners or access your administrative settings.
â€‹6ï¸âƒ£ Why GameBridge Is Powerful
â€‹âœ… Platform Control: You decide the value of an install or a level completion.
â€‹âœ… B2B Revenue: Your income comes from professional studios paying for performance, not from managing player payouts.
â€‹âœ… Data Integrity: Every launch and level-up is a hard-coded event, making your billing impossible to dispute.
â€‹âœ… Zero Friction: Works as a PWA; players don't need to install GameBridge itself to start playing.
â€‹7ï¸âƒ£ In One Sentence (Pitch Ready)
â€‹"GameBridge is a Firebase-powered PWA that monetizes game discovery by tracking ad views, installs, and level-based milestonesâ€”providing studios with a transparent, high-performance platform for user acquisition and billing

1ï¸âƒ£ User-Facing Features (Player Dashboard / App)

This is what your players will interact with.

a) Player Dashboard

Library of games: Display demos and full apps, with filtering by studio, category, or popularity.

Skeleton loaders & smooth UX: Loading animations while data is fetched.

Responsive design: Works on desktop and mobile.

Secure login/logout: Firebase Auth (Email/password, optional Google/Apple).

b) Monetization & Tracking

Rewarded Ads (Launch Demo)

Player watches ad â†’ unlocks demo.

Revenue logged to Firestore (per-user, per-game).

Install Attribution / CPI Tracking (Full App)

Clicking Full App redirects to Play/App Store via tracking link.

Install confirmed â†’ revenue logged.

Event logging: Track clicks, ad views, installs, session duration.

c) Progress Tracking

Milestones / Levels: Track which levels/milestones each player completed.

Optional achievements & badges: Gamification layer.

d) User account & profile

View username, email, total ad rewards earned.

Account management (change password, view history).

2ï¸âƒ£ Admin Portal (Web / Dashboard)

Admins need to manage games, track revenue, and view analytics.

a) Game Management

Add / edit / remove games.

Set status: active/inactive.

Set ad payout (adPayout) and install payout (installPayout).

Upload images / thumbnails / categories.

b) Revenue Tracking

View total ad revenue per game & per player.

View install revenue (CPI).

Aggregate analytics: daily/weekly/monthly totals.

c) Player Analytics

Track which players played which demos.

Track level/milestone completion.

Optional: Retention metrics (daily active users, sessions).

d) Admin Tools

Manual override of revenue.

Audit logs: who added/edited/removed a game.

Notifications for errors or suspicious behavior.

3ï¸âƒ£ Backend Requirements (Firebase)

Firebase provides serverless backend. Features needed:

a) Auth

Email/password (mandatory).

Optional OAuth: Google, Apple.

b) Firestore Collections

Collection	Description
games	Stores game info (title, studio, URL, adPayout, installPayout, status, createdAt, accumulatedRevenue)
events	Logs ad views, installs, clicks, and revenue events with userName, gameName, type, value, timestamp
playerProgress	Logs milestones / levels completed by player with milestonePaid flag
users	Optional: extra player data (profile, stats)
analytics	Optional: click tracking, session duration, engagement metrics

c) Security Rules

Players: Read only for active games, write only for their events.

Admins: Full read/write access.

Prevent overwriting revenue or injecting fake events.

d) Cloud Functions (Optional but recommended)

Process deferred installs or track real revenue events from affiliate SDK.

Send notifications to players (optional).

Update accumulatedRevenue automatically on events insertion.

4ï¸âƒ£ Ad & Monetization Integrations

a) Rewarded Ads

SDKs: Tapjoy, AppLovin, IronSource, AdMob.

Player must watch full ad â†’ revenue credited.

Optional: Cap ads per session/day.

b) Install Attribution / CPI

Affiliate SDK or tracking links.

Must confirm install â†’ revenue credited.

Optional: Deep link to store or redirect based on device OS.

c) Analytics & ROI Tracking

Track CTR for Play / Install buttons.

Track ad completions.

Provide per-game revenue reports to studios.














// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCLd4MLONU_5OFie6WN2XmXmlMyfuJ5_8I",
  authDomain: "gamebridge-f4789.firebaseapp.com",
  projectId: "gamebridge-f4789",
  storageBucket: "gamebridge-f4789.firebasestorage.app",
  messagingSenderId: "562553872482",
  appId: "1:562553872482:web:02b34e7bc1b7a25af8f13b",
  measurementId: "G-X3B8B4L4XW"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

















